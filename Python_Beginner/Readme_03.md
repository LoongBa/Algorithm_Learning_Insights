# 小学生 算法入门 案例精讲系列 2024 Python 版

## 之三：判断素数，初步学习穷举法及优化

---

**说明：**

> 本文内容较长，持续更新中，连载于：
> 
> - `github` [loongba/Algorithm_Learning_Insights](https://github.com/LoongBa/Algorithm_Learning_Insights)
> 
> - `gitcode` [loongba/Algorithm_Learning_Insights](https://gitcode.com/LoongBa/Algorithm_Learning_Insights)
> 
> - `gitee` [loongba/Algorithm_Learning_Insights](https://gitee.com/LoongBa/Algorithm_Learning_Insights)
> 
> - [loongba 个人网站1](https://coffeedrunk.cn) | [loongba 个人网站2](https://loongba.cn)

在 `github` 或 `markdown` 编辑器中阅读本文时，可打开其目录功能方便浏览和跳转。

> - `github` 页面中，点击文档右上角的目录图标；
> 
> - `marktext` 编辑器中，按 `Ctrl-K`

---

## 算法入门 案例精讲 Python 版 目录

0. [前言：使用说明](README.md)

1. [求回文数，练习拆分数字和进制转换](Readme_01.md)

2. [求水仙花数，了解枚举和迭代](Readme_02.md)

3. [判断素数，初步学习穷举法及优化](Readme_03.md)

4. [求阶和、阶乘，学习迭代和递归](Readme_04.md)

5. [求斐波那契数列，学习迭代和递归](Readme_05.md)

6. [辗转相除法求最大公约数，继续练习迭代和递归](Readme_06.md)

7. [求解汉诺塔问题，继续练习迭代和递归](Readme_07.md)

8. [求解迷宫问题，初步学习回溯](Readme_08.md)

9. [求解八皇后问题，继续练习回溯](Readme_09.md)

---

# 三、判断素数，初步学习穷举法及优化

> `素数`（又称为`质数`）是指在大于 `1` 的自然数中，除了 `1` 和 `它本身` 以外不再有其它因数的自然数。

## 题目要求:

> 求 100 之内的素数（质数）
> 
> - 写一个函数 `isPrime(number:int)` 判断 `number` 是否是素数，如果是则返回 `True`，否则返回 `False`；
> 
> - 然后用 `1-100` 的循环调用这个函数，判断每一个数字是否是素数并输出，如：
> 
> > 素数：2, 3, 5, 7, 11, ....
> > 非素数：1, 4, 6, 8, 9, 10, ...

## 思路分析：

> 对于 `n`，用从 `2` 到 `(n-1)` 的数去整除 `n`，只要有一个数能整除 `n` ，则 `n` 不是素数，反之是素数。
> 
> 也就是说，如果在 `2 ~ (n-1)` 之间找到任意一个数字能够整除 `n`，`n` 就不是素数。
> 
> 这种方法，称为`试除法`。

## 注意要点：

1. **注意要求的范围**：比如题目中 1 到 100，是否包含1、是否包含100？
   
   > 数学上把 `(1, 100]` 这样的集合称为：前开后闭的集合，范围是 `1 < n ≤ 100`，不包含`1`、包含`100`。
   > 
   > 类似还有：
   > 
   >  `(1, 100)`，前开后开的集合，范围是：
   > 
   > `[1, 100]`，前闭后闭的集合，范围是：
   > 
   > `(1, 100]`，
   > 
   > `[1, 100)`，以此类推。
   
   因为 1 不是素数（质数），所以本题的范围应该是？

2. **注意循环的起始和结束的边界范围**：
   
   > 比如 `for i in range(1, 100)`，对应上面的集合是哪一种？
   > 注意：不同计算机编程语言中，甚至相同编程语言中不同函数，它们的取值范围可能不一样。
   > 例如， `range(1, 100)` 对应的集合是 `[1, 100)`，而 `range(100)` 对应的集合是 `[0, 100)`。
   > 再例如，Python 中长度为 `n` 的列表的索引是从 `0` 开始到 `n-1`，范围是 `[0, n)`。代码中可用 `range(n)` 或者 `range(0, n)` 获得这个范围的整数值。如果试图用超过这个范围的数值作为索引访问列表中的某一项时，会导致代码运行时出现错误。

3. **注意整除与除的区别**：
   
   > 两种方法判断是否整除，常用“求余数”的方法，“求余”又称为“求模”。
   > 一个数除以另外一个数，余数为零，是整除。
   > 
   > 数学角度： `10 ÷ 3 = 3 ... 1` —— 十除以三，商为三，余数为一，
   > 用求余/求模运算：`10 % 3 = 1`。
   > 
   > 编程角度： `10 / 3 = 3.3333...` 小数点后有几位，取决于不同的数据类型所保留精度的范围，注意这一点，暂不展开。
   > 整除运算： `10 // 3 = 3` —— 十整除三，商为三，没有余数，此为 “整除” 。
   > 在编程中，整除也可以用除后保留整数部分来实现，例如取整函数、将浮点型转换为整型来实现。
   > 因为不同编程语言细节有差异，暂不展开。

4. **逐步优化算法**：先用代码编写出最简单的算法，再进一步优化。

> [判断素数 C 代码](https://github.com/coffeescholar/C_CPP-Learning/blob/main/%E7%AE%97%E6%B3%95%E5%85%A5%E9%97%A8%E7%BB%83%E4%B9%A0/01_%E6%B1%82%E7%B4%A0%E6%95%B0_%E7%A9%B7%E4%B8%BE_%E8%AF%95%E9%99%A4%E6%B3%95.c)

## 编程练习1：

Python 参考代码如下，请自行实现后再对照查阅：

```python
def isPrime(number: int):
    if number < 2:
        return False
    for i in range(2, number): # 从 2 到 n-1
        if number % i == 0:
            return False # 是否整除
    return True
```

接下来，使用循环调用这个函数来判断 `1 到 100` 的每一个数字是否为素数，并输出结果。以下是示例代码：

```python
for num in range(1, 100 + 1):
    if isPrime(num):
        print(num, end=" ")
print()  # 输出换行
```

这段代码会遍历 `1 到 100` 的每一个数字，判断是否为素数，如果是素数，则输出该数字。

注意：`range(1, 100 + 1)` 的边界范围。

## 算法知识：剪枝，缩小计算范围

本例用到一个循环：用每个数字去试除 `number`，这样的算法策略叫做 `穷举法`。

但即便是 `穷举法`，也是可以动脑筋 `进行优化` 的。

## 1. 优化：对上限剪枝、偶数

在上面的代码中，判断 `1 到 100` 中的素数是可以缩小判断的范围的。

从数学角度来看，一个正整数 `n` 的因数，除了自身之外不可能有大于 n/2 的因数。

所以，上面代码中，采用 `试除法` 的循环可以`缩小一半`：

```python
def isPrime(number: int):
    if number < 2:
        return False
    for i in range(2, number//2 + 1): # 从 2 到 n/2
        if number % i == 0:
            return False    # 是否整除
    return True
```

这样的优化，缩小了穷举的范围，减少了计算量，称为 `剪枝`。
——好比修剪树木，剪去多余的树枝而并不影响树木的生长。

既然提到了除了自身的因数不可能大于 $n/2$，那么 `2、3、5、7` 的倍数呢？——显然都不是素数，可以简单排除一下偶数，至少在 $n/2$ 的范围内又减少了一半：

```python
def isPrime(number: int):
    if number < 2:
        return False
    if number == 2:
        return True
    for i in range(3, number//2 + 1, 2): # 从 3 到 n/2 的奇数，步长为 2 跳过偶数
        if number % i == 0: # 是否整除
            return False
    return True
```

继续看，不仅 2 的倍数，3 的倍数也显然不是质数，2 x 3 = 6 包含了所有它们的公倍数，且起点可以从 5 开始，于是：

```python
def isPrime(number: int):
    if number < 2:
        return False
    if number == 2:
        return True
    if number == 3:
        return True
    if number % 2 == 0:  # 排除偶数
        return False
    if number % 3 == 0:  # 排除3的倍数
        return False
    # 从 5 到 n ** 0.5，步长 6，跳过 2、3 的倍数
    for i in range(5, int(number ** 0.5) + 1, 6):
        if number % i == 0:  # 是否整除
            return False
        if number % (i + 2) == 0:  # 检查 i + 2
            return False
    return True
```

> **思考：为何检查 i + 2 的情况？**

## 2. 再优化：继续剪枝，平方根

还能不能进一步剪枝呢？

可以。

> 一个数的因数，除了本身之外，不仅不会超过 $n/2$，
> 
> 还不会超过 $\sqrt{n}$。

于是，进一步剪枝的范围是：

> 从 3 到 $\sqrt{n}$ 的奇数，前开后闭。

在 Python 中，不引入 math 包的情况下，可用下面代码来计算 $\sqrt{n}$：

`int(number**0.5)`

> `number**n` 表示对 `number` 求 `n 次幂` 的运算，
> 
> `number**0.5` 表示对 `number` 求 $1/2$ 次幂——也就是求平方根，
> 
> 再将其抛弃小数部分（转换为整数）用到 `int()`，
> 
> 合起来就是：`int(number**0.5)`

所以，进一步剪枝后的代码如下：

```python
def isPrime(number: int):
    if number < 2:
        return False
    if number == 2:
        return True
    if number % 2 == 0: # 排除偶数
        return False
    # 从 5 到 n/2，步长 6，跳过 2、3 的倍数
    for i in range(5, int(number**0.5) + 1, 6):
        if number % i == 0: # 是否整除
            return False
    return True
```

——**为什么上限是** $\sqrt{n}$ ？

在试除法判断素数时，有一个重要的推论：

> 如果一个数 `n` 不是素数，那么它一定可以被两个因数 `a` 和 `b` 相乘得到，其中 $a <= b$。
> 
> 假设 `n` 可以被 `a` 整除（显然 `n` 不是素数），即 $n = a × b$。
> 
> 如果 `a` 大于 `n` 的平方根 `c`，那么 `b` 一定小于 `n` 的平方根 `c`，否则 $a × b$ 就会大于 $c^2 = n$，与前提矛盾。
> 
> 因此，在试除法中尝试的除数范围上限不超过 `n` 的平方根。

对于小学生小朋友，换个角度，借助几何来理解可能容易一些：

> - `n` 是某个长方形的面积。该长方形的长和宽假设为 `a, b`，则 $n = a × b$；
> 
> - 当两条边边长相等 $a = b = c$ 时，`n` 是一个边长为 `c` 的正方形 $n = c ^2$；
> 
> - 当两条边长度不相等时， $a < c < b$ 或 $a > c > b$。也就是说，其中一边长度肯定超过正方形边长，另外一边则小于正方形边长——否则 $a × b > c^2$。
> 
> ——也就是说，`a 或 b 必然有一边小于等于 c`，
> 
> 所以剪枝的上限可以设为 $c = \sqrt{n}$，也就是 `n 的平方根`。
> 
> 因为，判断素数只需要有一边能整除 `n` 即可
> ——按循环来看，显然先找到小的数字就不必再找成对的大的数字了。

- [ ] （待补充：<mark>这里可以引入 Geogebra 的动态公式</mark>）

## 扩展思考：

>  **$n/2$ 与 $\sqrt{n}$ 哪个大？——如何求证？**
> 
> 欲证明：$\sqrt{n} < n/2$
> 
> 1. 两边平方，得到：
>    
>    $n < (n/2)^2$
>    
>    化简得到：
>    
>    $n < n^2/4$
> 
> 2. 两边消4，得到：
>    
>    $4n < n^2$
> 
> 3. 两边消 n，得到：
>    
>    $4 < n，也就是 n>4$
> 
> 结论：$n >$ 4 时，$\sqrt{n} < n/2$ 成立。
> 
> 也就是说，$n>4$ 时， $\sqrt{n}$ 的范围比 $n/2$ 范围小。

---
